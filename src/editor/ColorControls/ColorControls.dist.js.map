{"version":3,"file":"ColorControls.dist.js","sources":["ColorControls.jsx"],"sourcesContent":["/* global wp */\r\nimport { PanelBody, Dropdown, Button, ColorIndicator, ColorPalette } from '@wordpress/components';\r\nimport { useEffect, useRef, useState } from '@wordpress/element';\r\nimport { BLOCKS_WITH_TINYMCE } from '../constants.js';\r\n\r\n/** @type {{ PluginManager: import('tinymce').AddOnManager }} */\r\nconst tinymce = window.tinymce;\r\n\r\nconst ColorPaletteDropdown = ({ label, hexValue, palette, onChange }) => {\r\n\tconst [hex, setHex] = useState(hexValue);\r\n\tconst triggerRef = useRef();\r\n\r\n\tconst getNameByColorValue = (colorValue) => {\r\n\t\tconst color = palette.find((c) => c.color === colorValue);\r\n\r\n\t\treturn color ? color.name : colorValue;\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Dropdown\r\n\t\t\trenderToggle={({ onToggle, isOpen }) => (\r\n\t\t\t\t<Button onClick={onToggle}\r\n\t\t\t\t\taria-expanded={isOpen}\r\n\t\t\t\t\tref={triggerRef}\r\n\t\t\t\t\t__next40pxDefaultSize\r\n\t\t\t\t>\r\n\t\t\t\t\t<ColorIndicator colorValue={hex}/>\r\n\t\t\t\t\t{label}\r\n\t\t\t\t</Button>\r\n\t\t\t)}\r\n\t\t\trenderContent={() => (\r\n\t\t\t\t<ColorPalette\r\n\t\t\t\t\tlabel={label}\r\n\t\t\t\t\tvalue={hex}\r\n\t\t\t\t\tcolors={palette}\r\n\t\t\t\t\tonChange={(color) => {\r\n\t\t\t\t\t\tsetHex(color ?? '');\r\n\t\t\t\t\t\tonChange(getNameByColorValue(color));\r\n\t\t\t\t\t\ttriggerRef.current?.focus();\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\t\t\t)}\r\n\t\t/>\r\n\t);\r\n};\r\n\r\nexport const ColorControls = (props) => {\r\n\tconst { attributes, setAttributes } = props;\r\n\r\n\t// TODO: Use component defaults from comet JS object (which are set using the PHP global Config object). They should take precedence over block.json\r\n\t// Use refs to keep track of the presence of attribute support without the fields disappearing when the colour field is cleared\r\n\tconst hasColorTheme = useRef(!!attributes?.colorTheme);\r\n\tconst hasBackgroundColor = useRef(!!attributes?.backgroundColor);\r\n\tif (!hasColorTheme.current && !hasBackgroundColor.current) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst palette = wp.data.select('core/block-editor').getSettings().colors;\r\n\tif (!palette || palette.length === 0) {\r\n\t\tconsole.warn('No colour palette found in block editor settings. Please ensure it is configured in theme.json to access colour attribute controls.');\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst getValueByColorName = (colorName) => {\r\n\t\tconst color = palette.find((c) => c.name === colorName);\r\n\r\n\t\treturn color ? color.color : colorName;\r\n\t};\r\n\r\n\tconst setTinyMceBodyAttribute = (attribute, value) => {\r\n\t\tif (BLOCKS_WITH_TINYMCE.includes(attributes.name)) {\r\n\t\t\tconst iframe = tinymce?.activeEditor?.iframeElement;\r\n\t\t\tif (iframe) {\r\n\t\t\t\tconst iframeBody = iframe.contentDocument.body;\r\n\t\t\t\tiframeBody.setAttribute(attribute, value ?? '');\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleThemeChange = (name) => {\r\n\t\tsetAttributes({ colorTheme: name ?? '' });\r\n\t\tsetTinyMceBodyAttribute('data-color-theme', name ?? '');\r\n\t};\r\n\r\n\tconst handleBackgroundChange = (name) => {\r\n\t\tsetAttributes({ backgroundColor: name ?? '' });\r\n\t\tsetTinyMceBodyAttribute('data-background', name ?? '');\r\n\t};\r\n\r\n\t// On load, set the TinyMCE body attributes if applicable\r\n\tuseEffect(() => {\r\n\t\tsetTinyMceBodyAttribute('data-color-theme', attributes?.colorTheme ?? '');\r\n\t\tsetTinyMceBodyAttribute('data-background', attributes?.backgroundColor ?? '');\r\n\t}, []);\r\n\r\n\t// TODO: Limit valid combinations of background + theme where appropriate\r\n\treturn (\r\n\t\t<PanelBody title=\"Colours\" initialOpen={true} className=\"comet-color-controls\">\r\n\t\t\t{hasColorTheme.current && (\r\n\t\t\t\t<div className=\"comet-color-controls__item\">\r\n\t\t\t\t\t<ColorPaletteDropdown\r\n\t\t\t\t\t\tlabel=\"Theme\"\r\n\t\t\t\t\t\thexValue={getValueByColorName(attributes?.colorTheme) ?? ''}\r\n\t\t\t\t\t\tpalette={palette}\r\n\t\t\t\t\t\tonChange={handleThemeChange}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t\t{hasBackgroundColor.current && (\r\n\t\t\t\t<div className=\"comet-color-controls__item\">\r\n\t\t\t\t\t<ColorPaletteDropdown\r\n\t\t\t\t\t\tlabel=\"Background\"\r\n\t\t\t\t\t\thexValue={getValueByColorName(attributes?.backgroundColor) ?? ''}\r\n\t\t\t\t\t\tpalette={palette}\r\n\t\t\t\t\t\tonChange={handleBackgroundChange}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t</PanelBody>\r\n\t);\r\n};\r\n"],"names":["PanelBody","Dropdown","Button","ColorIndicator","ColorPalette","wp","components","useEffect","useRef","useState","element","tinymce","window","ColorPaletteDropdown","label","hexValue","palette","onChange","hex","setHex","triggerRef","getNameByColorValue","colorValue","color","find","c","name","React","createElement","renderToggle","onToggle","isOpen","onClick","ref","__next40pxDefaultSize","renderContent","value","colors","current","focus","ColorControls","props","attributes","setAttributes","hasColorTheme","colorTheme","hasBackgroundColor","backgroundColor","data","select","getSettings","length","console","warn","getValueByColorName","colorName","setTinyMceBodyAttribute","attribute","BLOCKS_WITH_TINYMCE","includes","iframe","activeEditor","iframeElement","iframeBody","contentDocument","body","setAttribute","handleThemeChange","handleBackgroundChange","title","initialOpen","className"],"mappings":"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"}
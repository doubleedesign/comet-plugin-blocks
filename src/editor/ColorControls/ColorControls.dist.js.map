{"version":3,"file":"ColorControls.dist.js","sources":["ColorControls.jsx"],"sourcesContent":["/* global wp */\r\nimport { PanelBody, Dropdown, Button, ColorIndicator, ColorPalette, GradientPicker } from '@wordpress/components';\r\nimport { useEffect, useMemo, useRef, useState } from '@wordpress/element';\r\n\r\nexport const ColorControls = ({ name, attributes, setAttributes }) => {\r\n\tconst palette = Object.entries(comet?.palette)\r\n\t\t?.filter(([key, value]) => !['black', 'white'].includes(key))\r\n\t\t?.map(([key, value]) => ({ slug: key, name: key, color: value }))\r\n\t\t?? wp.data.select('core/block-editor').getSettings().colors;\r\n\r\n\tif (!palette || palette.length === 0) {\r\n\t\t// eslint-disable-next-line max-len\r\n\t\tconsole.error('No colour palette found in component library configuration. You can use theme.json or the comet_canvas_theme_colours filter to add colours. Developers: See set_colours() in ThemeStyle.php in the plugin source for more implementation details.');\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst componentDefault = comet?.defaults[name.replace('comet/', '')] ?? {};\r\n\tconst startValues = {\r\n\t\tcolorTheme: attributes?.colorTheme ?? componentDefault?.colorTheme ?? null,\r\n\t\tbackgroundColor: attributes?.backgroundColor ?? componentDefault?.backgroundColor ?? null,\r\n\t};\r\n\r\n\r\n\t// Use refs to keep track of the presence of attribute support without the fields disappearing when the colour field is cleared\r\n\tconst hasColorThemeSupport = useRef(!!startValues.colorTheme);\r\n\tconst hasBackgroundColorSupport = useRef(!!startValues.backgroundColor);\r\n\r\n\tif (!hasColorThemeSupport.current && !hasBackgroundColorSupport.current) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst [foregroundColor, setForegroundColor] = useState(startValues.colorTheme);\r\n\tconst [backgroundColor, setBackgroundColor] = useState(startValues.backgroundColor);\r\n\r\n\tconst getValueByColorName = (colorName) => {\r\n\t\tconst color = palette.find((c) => c.slug === colorName);\r\n\r\n\t\treturn color ? color.color : colorName;\r\n\t};\r\n\r\n\tconst handleThemeChange = (name) => {\r\n\t\tsetForegroundColor(name);\r\n\t\tsetAttributes({ colorTheme: name ?? '' });\r\n\t};\r\n\r\n\tconst handleBackgroundChange = (name) => {\r\n\t\tsetBackgroundColor(name);\r\n\t\tsetAttributes({ backgroundColor: name ?? '' });\r\n\t};\r\n\r\n\t// If background colour is not supported, provide single colour theme option\r\n\tif (!hasBackgroundColorSupport.current) {\r\n\t\treturn (\r\n\t\t\t<div className=\"comet-color-controls__item\">\r\n\t\t\t\t<ColorPaletteDropdown\r\n\t\t\t\t\tlabel=\"Theme\"\r\n\t\t\t\t\thexValue={getValueByColorName(attributes?.colorTheme) ?? ''}\r\n\t\t\t\t\tpalette={palette}\r\n\t\t\t\t\tonChange={handleThemeChange}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\t// If both colour theme and background colour are available, provide colour pair selection\r\n\treturn (\r\n\t\t<div className=\"comet-color-controls__item\">\r\n\t\t\t<ColorPairPaletteDropdown\r\n\t\t\t\tlabel=\"Theme\"\r\n\t\t\t\tvalue={{\r\n\t\t\t\t\tforeground: foregroundColor,\r\n\t\t\t\t\tbackground: backgroundColor,\r\n\t\t\t\t}}\r\n\t\t\t\tpairs={comet?.colourPairs ?? []}\r\n\t\t\t\tonChange={(newValue) => {\r\n\t\t\t\t\thandleThemeChange(newValue.foreground);\r\n\t\t\t\t\thandleBackgroundChange(newValue.background);\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nfunction ColorPaletteDropdown({ label, hexValue, palette, onChange }) {\r\n\tconst [hex, setHex] = useState(hexValue);\r\n\tconst triggerRef = useRef();\r\n\r\n\tconst getNameByColorValue = (colorValue) => {\r\n\t\tconst color = palette.find((c) => c.color === colorValue);\r\n\r\n\t\treturn color ? color.slug : colorValue;\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Dropdown\r\n\t\t\trenderToggle={({ onToggle, isOpen }) => (\r\n\t\t\t\t<Button onClick={onToggle}\r\n\t\t\t\t\taria-expanded={isOpen}\r\n\t\t\t\t\tref={triggerRef}\r\n\t\t\t\t\t__next40pxDefaultSize\r\n\t\t\t\t>\r\n\t\t\t\t\t<ColorIndicator colorValue={hex}/>\r\n\t\t\t\t\t{label}\r\n\t\t\t\t</Button>\r\n\t\t\t)}\r\n\t\t\trenderContent={({ onToggle }) => (\r\n\t\t\t\t<ColorPalette\r\n\t\t\t\t\tlabel={label}\r\n\t\t\t\t\tvalue={hex}\r\n\t\t\t\t\tcolors={palette}\r\n\t\t\t\t\tonChange={(color) => {\r\n\t\t\t\t\t\tsetHex(color ?? '');\r\n\t\t\t\t\t\tonChange(getNameByColorValue(color));\r\n\t\t\t\t\t\tonToggle(); // close dropdown after selection\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\t\t\t)}\r\n\t\t/>\r\n\t);\r\n}\r\n\r\nfunction ColorPairPaletteDropdown({ label, value, pairs, onChange }) {\r\n\tconst [foreground, setForeground] = useState(value?.foreground ?? '');\r\n\tconst [background, setBackground] = useState(value?.background !== 'transparent' ? value?.background : (comet?.globalBackground ?? 'white'));\r\n\tconst triggerRef = useRef();\r\n\r\n\tconst palette = pairs.map((pair) => ({\r\n\t\tname: `${pair.foreground} on ${pair.background}`,\r\n\t\tslug: `${pair.foreground}-${pair.background}`,\r\n\t\tgradient: `linear-gradient(135deg, var(--color-${pair.foreground}) 0%, var(--color-${pair.foreground}) 50%, var(--color-${pair.background}) 50%, var(--color-${pair.background}) 100%)`,\r\n\t}));\r\n\r\n\tconst gradientPreview = useMemo(() => {\r\n\t\treturn `linear-gradient(135deg, var(--color-${foreground}) 0%, var(--color-${foreground}) 50%, var(--color-${background}) 50%, var(--color-${background}) 100%)`;\r\n\t}, [foreground, background]);\r\n\r\n\tconst handleChange = (newValue) => {\r\n\t\t// New value is the gradient string; find the matching palette object\r\n\t\tconst matchedPair = palette.find((pair) => pair.gradient === newValue);\r\n\r\n\t\tif (matchedPair) {\r\n\t\t\tconst [newForeground, newBackground] = matchedPair.slug.split('-');\r\n\t\t\tsetForeground(newForeground);\r\n\t\t\tsetBackground(newBackground);\r\n\t\t\tonChange({\r\n\t\t\t\tforeground: newForeground,\r\n\t\t\t\tbackground: newBackground,\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Dropdown\r\n\t\t\trenderToggle={({ onToggle, isOpen }) => (\r\n\t\t\t\t<Button onClick={onToggle}\r\n\t\t\t\t\taria-expanded={isOpen}\r\n\t\t\t\t\tref={triggerRef}\r\n\t\t\t\t\t__next40pxDefaultSize\r\n\t\t\t\t>\r\n\t\t\t\t\t<ColorIndicator colorValue={gradientPreview}/>\r\n\t\t\t\t\t{label}\r\n\t\t\t\t</Button>\r\n\t\t\t)}\r\n\t\t\trenderContent={({ isOpen, onToggle }) => (\r\n\t\t\t\t<GradientPicker\r\n\t\t\t\t\tlabel={label}\r\n\t\t\t\t\tvalue={gradientPreview}\r\n\t\t\t\t\tgradients={palette}\r\n\t\t\t\t\tdisableCustomGradients={true}\r\n\t\t\t\t\tonChange={(value) => {\r\n\t\t\t\t\t\thandleChange(value);\r\n\t\t\t\t\t\tonToggle(); // close dropdown after selection\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\t\t\t)}\r\n\t\t/>\r\n\t);\r\n}\r\n"],"names":["PanelBody","Dropdown","Button","ColorIndicator","ColorPalette","GradientPicker","wp","components","useEffect","useMemo","useRef","useState","element","ColorControls","name","attributes","setAttributes","palette","Object","entries","comet","filter","key","value","includes","map","slug","color","data","select","getSettings","colors","length","console","error","componentDefault","defaults","replace","startValues","colorTheme","backgroundColor","hasColorThemeSupport","hasBackgroundColorSupport","current","foregroundColor","setForegroundColor","setBackgroundColor","getValueByColorName","colorName","find","c","handleThemeChange","handleBackgroundChange","React","createElement","className","ColorPaletteDropdown","label","hexValue","onChange","ColorPairPaletteDropdown","foreground","background","pairs","colourPairs","newValue","hex","setHex","triggerRef","getNameByColorValue","colorValue","renderToggle","onToggle","isOpen","onClick","ref","__next40pxDefaultSize","renderContent","setForeground","setBackground","globalBackground","pair","gradient","gradientPreview","handleChange","matchedPair","newForeground","newBackground","split","gradients","disableCustomGradients"],"mappings":"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"}
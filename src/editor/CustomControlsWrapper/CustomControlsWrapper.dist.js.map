{"version":3,"file":"CustomControlsWrapper.dist.js","sources":["CustomControlsWrapper.jsx"],"sourcesContent":["/* global wp */\r\nimport { addFilter } from '@wordpress/hooks';\r\nimport { InspectorControls } from '@wordpress/block-editor';\r\nimport ServerSideRender from '@wordpress/server-side-render';\r\nimport { LayoutControls } from '../LayoutControls/LayoutControls.jsx';\r\nimport { ColorControls } from '../ColorControls/ColorControls.jsx';\r\nimport { PanelBody, SelectControl } from '@wordpress/components';\r\nimport { useMemo } from '@wordpress/element';\r\n\r\n/**\r\n * Note: This file needs to be compiled (Rollup is configured for this)\r\n * and loaded into the editor via the enqueue_block_editor_assets PHP hook\r\n */\r\nwp.domReady(() => {\r\n\taddFilter(\r\n\t\t'editor.BlockEdit',\r\n\t\t'comet-plugin-blocks/custom-controls',\r\n\t\t(BlockEdit) => (props) => {\r\n\r\n\t\t\tconst BlockEditComponent = useMemo(() => {\r\n\t\t\t\tif (props?.name === 'ninja-forms/form') {\r\n\t\t\t\t\treturn NinjaFormsControls;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn CometBlockEdit;\r\n\t\t\t}, [props?.name]);\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"comet-block-edit-wrapper\"\r\n\t\t\t\t\tdata-block={props.name}\r\n\t\t\t\t\tdata-background={props?.attributes?.backgroundColor ?? comet?.globalBackground ?? undefined}\r\n\t\t\t\t\t//data-size={props?.attributes?.backgroundSize} // TODO: Implement this in a way that's not confusing with inner container size\r\n\t\t\t\t>\r\n\t\t\t\t\t<BlockEditComponent BlockEdit={BlockEdit} {...props} />\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t});\r\n});\r\n\r\n\r\n/**\r\n * Render BlockEdit component with controls for custom attributes\r\n * @param BlockEdit The original BlockEdit component\r\n * @param {Object} props The block edit props\r\n * @returns {JSX.Element}\r\n * @constructor\r\n */\r\nfunction CometBlockEdit({ BlockEdit, ...props }) {\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div className=\"comet-plugin-blocks-custom-controls\">\r\n\t\t\t\t<InspectorControls>\r\n\t\t\t\t\t<LayoutControls {...props} />\r\n\t\t\t\t\t<ColorControls {...props} />\r\n\t\t\t\t</InspectorControls>\r\n\t\t\t</div>\r\n\t\t\t<BlockEdit {...props} />\r\n\t\t</>\r\n\t);\r\n}\r\n\r\n/**\r\n * Recreate the Ninja Form selector dropdown control so that it is wrapped in the same components as our custom controls,\r\n * and also enables us to use server-side rendering for the block preview instead of BlockEdit\r\n * (which would render both the default preview + the default form selector)\r\n * @param {Object} props The block edit props\r\n *\r\n * FIXME: This currently gets stuck on the loading spinner when rendering the form.\r\n */\r\nfunction NinjaFormsControls(props) {\r\n\tconst { name, attributes, setAttributes } = props;\r\n\tif (name !== 'ninja-forms/form') {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst options = Object.values(window?.nfFormsBlock?.forms)?.map(({ formID, formTitle }) => ({\r\n\t\tlabel: `${formTitle} (ID: ${formID})`,\r\n\t\tvalue: formID,\r\n\t}));\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div className=\"comet-plugin-blocks-custom-controls\">\r\n\t\t\t\t<InspectorControls>\r\n\t\t\t\t\t<LayoutControls {...props} />\r\n\t\t\t\t\t<ColorControls {...props} />\r\n\t\t\t\t\t<PanelBody title=\"Content\" initialOpen={true}>\r\n\t\t\t\t\t\t<SelectControl\r\n\t\t\t\t\t\t\tlabel=\"Form\"\r\n\t\t\t\t\t\t\tsize={'__unstable-large'}\r\n\t\t\t\t\t\t\tvalue={attributes.formID}\r\n\t\t\t\t\t\t\toptions={options ?? []}\r\n\t\t\t\t\t\t\tonChange={(value) => {\r\n\t\t\t\t\t\t\t\tsetAttributes({\r\n\t\t\t\t\t\t\t\t\tformID: parseInt(value),\r\n\t\t\t\t\t\t\t\t\tformTitle: options.find(option => option.value === parseInt(value))?.label || '',\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</PanelBody>\r\n\t\t\t\t</InspectorControls>\r\n\t\t\t</div>\r\n\t\t\t<ServerSideRender block=\"ninja-forms/form\" attributes={props.attributes}/>\r\n\t\t</>\r\n\t);\r\n}\r\n"],"names":["addFilter","wp","hooks","InspectorControls","blockEditor","ServerSideRender","serverSideRender","PanelBody","SelectControl","components","useMemo","element","domReady","BlockEdit","props","BlockEditComponent","name","NinjaFormsControls","CometBlockEdit","React","createElement","className","attributes","backgroundColor","comet","globalBackground","undefined","_extends","Fragment","LayoutControls","ColorControls","setAttributes","options","Object","values","window","nfFormsBlock","forms","map","formID","formTitle","label","value","title","initialOpen","size","onChange","parseInt","find","option","block"],"mappings":"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"}
{"version":3,"file":"CustomControlsWrapper.dist.js","sources":["CustomControlsWrapper.jsx"],"sourcesContent":["/* global wp */\r\nimport { addFilter } from '@wordpress/hooks';\r\nimport { InspectorControls, InspectorAdvancedControls } from '@wordpress/block-editor';\r\nimport ServerSideRender from '@wordpress/server-side-render';\r\nimport { LayoutControls } from '../LayoutControls/LayoutControls.jsx';\r\nimport { ColorControls } from '../ColorControls/ColorControls.jsx';\r\nimport { PanelBody, SelectControl } from '@wordpress/components';\r\nimport { useMemo } from '@wordpress/element';\r\nimport { BackgroundType } from '../BackgroundType/BackgroundType.jsx';\r\nimport { BackgroundOpacity } from '../BackgroundOpacity/BackgroundOpacity.jsx';\r\nimport { HtmlTag } from '../HtmlTag/HtmlTag.jsx';\r\n\r\n/**\r\n * Note: This file needs to be compiled (Rollup is configured for this)\r\n * and loaded into the editor via the enqueue_block_editor_assets PHP hook\r\n */\r\nwp.domReady(() => {\r\n\taddFilter(\r\n\t\t'editor.BlockEdit',\r\n\t\t'comet-plugin-blocks/custom-controls',\r\n\t\t(BlockEdit) => (props) => {\r\n\r\n\t\t\tconst BlockEditComponent = useMemo(() => {\r\n\t\t\t\tif (props?.name === 'ninja-forms/form') {\r\n\t\t\t\t\treturn NinjaFormsControls;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn CometBlockEdit;\r\n\t\t\t}, [props?.name]);\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"comet-block-edit-wrapper\" data-block={props.name}>\r\n\t\t\t\t\t<BlockEditComponent BlockEdit={BlockEdit} {...props} />\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t});\r\n});\r\n\r\n\r\n/**\r\n * Render BlockEdit component with controls for custom attributes\r\n * @param BlockEdit The original BlockEdit component\r\n * @param {Object} props The block edit props\r\n * @returns {JSX.Element}\r\n * @constructor\r\n */\r\nfunction CometBlockEdit({ BlockEdit, ...props }) {\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div className=\"comet-plugin-blocks-custom-controls\">\r\n\t\t\t\t<InspectorControls>\r\n\t\t\t\t\t<LayoutControls {...props} />\r\n\t\t\t\t\t{Object.keys(props?.attributes).some(attr => ['colorTheme', 'backgroundColor', 'backgroundOpacity', 'backgroundType'].includes(attr)) && (\r\n\t\t\t\t\t\t<PanelBody title=\"Colours\" initialOpen={true}\r\n\t\t\t\t\t\t\tclassName={`comet-color-controls comet-color-controls--${props.name.split('/')[1]}`}>\r\n\t\t\t\t\t\t\t<ColorControls {...props} />\r\n\t\t\t\t\t\t\t<BackgroundOpacity {...props}/>\r\n\t\t\t\t\t\t\t<BackgroundType {...props} />\r\n\t\t\t\t\t\t</PanelBody>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</InspectorControls>\r\n\t\t\t\t<InspectorAdvancedControls>\r\n\t\t\t\t\t<HtmlTag {...props} />\r\n\t\t\t\t</InspectorAdvancedControls>\r\n\t\t\t</div>\r\n\t\t\t<BlockEdit {...props} />\r\n\t\t</>\r\n\t);\r\n}\r\n\r\n/**\r\n * Recreate the Ninja Form selector dropdown control so that it is wrapped in the same components as our custom controls,\r\n * and also enables us to use server-side rendering for the block preview instead of BlockEdit\r\n * (which would render both the default preview + the default form selector)\r\n * @param {Object} props The block edit props\r\n *\r\n * FIXME: This currently gets stuck on the loading spinner when rendering the form.\r\n */\r\nfunction NinjaFormsControls(props) {\r\n\tconst { name, attributes, setAttributes } = props;\r\n\tif (name !== 'ninja-forms/form') {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst options = Object.values(window?.nfFormsBlock?.forms)?.map(({ formID, formTitle }) => ({\r\n\t\tlabel: `${formTitle} (ID: ${formID})`,\r\n\t\tvalue: formID,\r\n\t}));\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div className=\"comet-plugin-blocks-custom-controls\">\r\n\t\t\t\t<InspectorControls>\r\n\t\t\t\t\t<LayoutControls {...props} />\r\n\t\t\t\t\t<ColorControls {...props} />\r\n\t\t\t\t\t<PanelBody title=\"Content\" initialOpen={true}>\r\n\t\t\t\t\t\t<SelectControl\r\n\t\t\t\t\t\t\tlabel=\"Form\"\r\n\t\t\t\t\t\t\tsize={'__unstable-large'}\r\n\t\t\t\t\t\t\tvalue={attributes.formID}\r\n\t\t\t\t\t\t\toptions={options ?? []}\r\n\t\t\t\t\t\t\tonChange={(value) => {\r\n\t\t\t\t\t\t\t\tsetAttributes({\r\n\t\t\t\t\t\t\t\t\tformID: parseInt(value),\r\n\t\t\t\t\t\t\t\t\tformTitle: options.find(option => option.value === parseInt(value))?.label || '',\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</PanelBody>\r\n\t\t\t\t</InspectorControls>\r\n\t\t\t</div>\r\n\t\t\t<ServerSideRender block=\"ninja-forms/form\" attributes={props.attributes}/>\r\n\t\t</>\r\n\t);\r\n}\r\n"],"names":["addFilter","wp","hooks","InspectorControls","InspectorAdvancedControls","blockEditor","ServerSideRender","serverSideRender","PanelBody","SelectControl","components","useMemo","element","domReady","BlockEdit","props","BlockEditComponent","name","NinjaFormsControls","CometBlockEdit","React","createElement","className","_extends","Fragment","LayoutControls","Object","keys","attributes","some","attr","includes","title","initialOpen","split","ColorControls","BackgroundOpacity","BackgroundType","HtmlTag","setAttributes","options","values","window","nfFormsBlock","forms","map","formID","formTitle","label","value","size","onChange","parseInt","find","option","block"],"mappings":"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"}
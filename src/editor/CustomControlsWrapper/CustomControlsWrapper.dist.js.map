{"version":3,"file":"CustomControlsWrapper.dist.js","sources":["CustomControlsWrapper.jsx"],"sourcesContent":["/* global wp */\r\nimport { addFilter, addAction } from '@wordpress/hooks';\r\nimport { InspectorControls } from '@wordpress/block-editor';\r\nimport { LayoutControls } from '../LayoutControls/LayoutControls.jsx';\r\nimport { ColorControls } from '../ColorControls/ColorControls.jsx';\r\nimport { BLOCKS_WITH_TINYMCE } from '../constants.js';\r\n\r\n/** @type {{ PluginManager: import('tinymce').AddOnManager }} */\r\nconst tinymce = window.tinymce;\r\n\r\n/**\r\n * Note: This file needs to be compiled (Rollup is configured for this)\r\n * and loaded into the editor via the enqueue_block_editor_assets PHP hook\r\n */\r\nwp.domReady(() => {\r\n\r\n\r\n\tfunction unsubscribe() {\r\n\t\twp.data.subscribe(function () {\r\n\t\t});\r\n\t}\r\n\r\n\r\n\t// Add attributes to the inner <body> of TinyMCE editors inside blocks on first load\r\n\t// (Changes are taken care of in the relevant attribute control components)\r\n\twp.data.subscribe(() => {\r\n\t\tconst blocks = wp.data.select('core/block-editor').getBlocks();\r\n\r\n\t\tif (blocks.length > 0) {\r\n\t\t\tunsubscribe(); // Stop listening once blocks are loaded\r\n\r\n\t\t\t// For each block with a TinyMCE editor, match the editor instance and set attributes\r\n\t\t\tblocks.forEach((block, index) => {\r\n\t\t\t\tif (BLOCKS_WITH_TINYMCE.includes(block.name)) {\r\n\t\t\t\t\tconst clientId = block.clientId;\r\n\t\t\t\t\t// Split name after \"acf-block_\" up until the first [ to match the editor to the block\r\n\t\t\t\t\tconst editor = tinymce?.editors.find(editor => editor.targetElm.name.slice(10, editor.targetElm.name.indexOf('[')) === clientId);\r\n\t\t\t\t\tif (editor) {\r\n\t\t\t\t\t\tconst iframe = editor.iframeElement;\r\n\t\t\t\t\t\tif (iframe) {\r\n\t\t\t\t\t\t\tconst iframeBody = iframe.contentDocument.body;\r\n\t\t\t\t\t\t\tiframeBody.setAttribute('data-color-theme', block.attributes?.colorTheme ?? '');\r\n\t\t\t\t\t\t\tiframeBody.setAttribute('data-background', block.attributes?.backgroundColor ?? '');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\taddFilter(\r\n\t\t'editor.BlockEdit',\r\n\t\t'comet-plugin-blocks/custom-controls',\r\n\t\t(BlockEdit) => (props) => {\r\n\r\n\t\t\tconst setTinyMceBodyAttribute = (attribute, value) => {\r\n\t\t\t\tif (BLOCKS_WITH_TINYMCE.includes(props.attributes.name)) {\r\n\r\n\r\n\t\t\t\t\tconst iframe = tinymce?.activeEditor?.iframeElement;\r\n\t\t\t\t\tif (iframe) {\r\n\t\t\t\t\t\tconst iframeBody = iframe.contentDocument.body;\r\n\t\t\t\t\t\tiframeBody.setAttribute(attribute, value ?? '');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"comet-block-edit-wrapper\"\r\n\t\t\t\t\tdata-block={props.name}\r\n\t\t\t\t\tdata-background={props?.attributes?.backgroundColor ?? comet?.globalBackground ?? 'white'}\r\n\t\t\t\t\tdata-size={props?.attributes?.backgroundSize ?? 'fullwidth'}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div className=\"comet-plugin-blocks-custom-controls\">\r\n\t\t\t\t\t\t<InspectorControls>\r\n\t\t\t\t\t\t\t<LayoutControls {...props} />\r\n\t\t\t\t\t\t\t<ColorControls {...props} />\r\n\t\t\t\t\t\t</InspectorControls>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<BlockEdit {...props} />\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t});\r\n});\r\n"],"names":["addFilter","addAction","wp","hooks","InspectorControls","blockEditor","tinymce","window","domReady","unsubscribe","data","subscribe","blocks","select","getBlocks","length","forEach","block","index","BLOCKS_WITH_TINYMCE","includes","name","clientId","editor","editors","find","targetElm","slice","indexOf","iframe","iframeElement","iframeBody","contentDocument","body","setAttribute","attributes","colorTheme","backgroundColor","BlockEdit","props","React","createElement","className","comet","globalBackground","backgroundSize","LayoutControls","ColorControls"],"mappings":";;;;AAAA;AACA,MAAM;EAAEA,SAAS;AAAEC,EAAAA;AAAU,CAAC,GAAGC,EAAE,CAACC,KAAK;AACzC,MAAM;AAAEC,EAAAA;AAAkB,CAAC,GAAGF,EAAE,CAACG,WAAW;;AAK5C;AACA,MAAMC,OAAO,GAAGC,MAAM,CAACD,OAAO;;AAE9B;AACA;AACA;AACA;AACAJ,EAAE,CAACM,QAAQ,CAAC,MAAM;EAGjB,SAASC,WAAWA,GAAG;IACtBP,EAAE,CAACQ,IAAI,CAACC,SAAS,CAAC,YAAY,CAC9B,CAAC,CAAC;AACH,EAAA;;AAGA;AACA;AACAT,EAAAA,EAAE,CAACQ,IAAI,CAACC,SAAS,CAAC,MAAM;AACvB,IAAA,MAAMC,MAAM,GAAGV,EAAE,CAACQ,IAAI,CAACG,MAAM,CAAC,mBAAmB,CAAC,CAACC,SAAS,EAAE;AAE9D,IAAA,IAAIF,MAAM,CAACG,MAAM,GAAG,CAAC,EAAE;MACtBN,WAAW,EAAE,CAAC;;AAEd;AACAG,MAAAA,MAAM,CAACI,OAAO,CAAC,CAACC,KAAK,EAAEC,KAAK,KAAK;QAChC,IAAIC,mBAAmB,CAACC,QAAQ,CAACH,KAAK,CAACI,IAAI,CAAC,EAAE;AAC7C,UAAA,MAAMC,QAAQ,GAAGL,KAAK,CAACK,QAAQ;AAC/B;AACA,UAAA,MAAMC,MAAM,GAAGjB,OAAO,EAAEkB,OAAO,CAACC,IAAI,CAACF,MAAM,IAAIA,MAAM,CAACG,SAAS,CAACL,IAAI,CAACM,KAAK,CAAC,EAAE,EAAEJ,MAAM,CAACG,SAAS,CAACL,IAAI,CAACO,OAAO,CAAC,GAAG,CAAC,CAAC,KAAKN,QAAQ,CAAC;AAChI,UAAA,IAAIC,MAAM,EAAE;AACX,YAAA,MAAMM,MAAM,GAAGN,MAAM,CAACO,aAAa;AACnC,YAAA,IAAID,MAAM,EAAE;AACX,cAAA,MAAME,UAAU,GAAGF,MAAM,CAACG,eAAe,CAACC,IAAI;AAC9CF,cAAAA,UAAU,CAACG,YAAY,CAAC,kBAAkB,EAAEjB,KAAK,CAACkB,UAAU,EAAEC,UAAU,IAAI,EAAE,CAAC;AAC/EL,cAAAA,UAAU,CAACG,YAAY,CAAC,iBAAiB,EAAEjB,KAAK,CAACkB,UAAU,EAAEE,eAAe,IAAI,EAAE,CAAC;AACpF,YAAA;AACD,UAAA;AACD,QAAA;AACD,MAAA,CAAC,CAAC;AACH,IAAA;AACD,EAAA,CAAC,CAAC;EAEFrC,SAAS,CACR,kBAAkB,EAClB,qCAAqC,EACpCsC,SAAS,IAAMC,KAAK,IAAK;IAczB,oBACCC,KAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AAAKC,MAAAA,SAAS,EAAC,0BAA0B;MACxC,YAAA,EAAYH,KAAK,CAAClB,IAAK;MACvB,iBAAA,EAAiBkB,KAAK,EAAEJ,UAAU,EAAEE,eAAe,IAAIM,KAAK,EAAEC,gBAAgB,IAAI,OAAQ;AAC1F,MAAA,WAAA,EAAWL,KAAK,EAAEJ,UAAU,EAAEU,cAAc,IAAI;KAAY,eAE5DL,KAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AAAKC,MAAAA,SAAS,EAAC;AAAqC,KAAA,eACnDF,KAAA,CAAAC,aAAA,CAACrC,iBAAiB,EAAA,IAAA,eACjBoC,KAAA,CAAAC,aAAA,CAACK,cAAc,EAAKP,KAAQ,CAAC,eAC7BC,KAAA,CAAAC,aAAA,CAACM,aAAa,EAAKR,KAAQ,CACT,CACf,CAAC,eACNC,KAAA,CAAAC,aAAA,CAACH,SAAS,EAAKC,KAAQ,CACnB,CAAC;AAER,EAAA,CAAC,CAAC;AACJ,CAAC,CAAC"}